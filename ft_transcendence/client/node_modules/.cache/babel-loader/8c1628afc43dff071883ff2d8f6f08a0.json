{"ast":null,"code":"import _regeneratorRuntime from\"/home/sayi/ft/base/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/sayi/ft/base/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/sayi/ft/base/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import ChatInput from\"./ChatInput\";import ChatLog from\"./ChatLog\";import Loading from\"./Loading\";import UserList from\"./UserList\";import SideBar from\"../SideBar/SideBar\";import\"./styles/Chat.scss\";import setting from'../Images/setting.png';import ChatSettingModal from\"./ChatSettingModal\";import axios from\"axios\";import useSwr from'swr';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var socketIOClient=require('socket.io-client');var Chat=function Chat(){var currentSocket=socketIOClient('http://localhost:8080');var _useState=useState(''),_useState2=_slicedToArray(_useState,2),MyID=_useState2[0],setMyID=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),roomName=_useState4[0],setRoomName=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),MyPermission=_useState6[0],setMyPermission=_useState6[1];var fetcher=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(url){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!roomName){_context.next=6;break;}_context.next=3;return axios.get(url);case 3:res=_context.sent;res.data.users=userSorting(res.data.users);return _context.abrupt(\"return\",res.data);case 6:case\"end\":return _context.stop();}}},_callee);}));return function fetcher(_x){return _ref.apply(this,arguments);};}();var _useSwr=useSwr('/Chat/info?title='+roomName,fetcher),data=_useSwr.data,error=_useSwr.error,mutate=_useSwr.mutate;function userSorting(userList){var rtn=[];var admin=[];var user=[];for(var i=0;i<userList.length;i++){if(userList[i].id===MyID)setMyPermission(userList[i].permission);if(userList[i].permission==='owner')rtn.push(userList[i]);else if(userList[i].permission==='admin')admin.push(userList[i]);else user.push(userList[i]);}admin.forEach(function(ele){return rtn.push(ele);});user.forEach(function(ele){return rtn.push(ele);});return rtn;}useEffect(function(){//setCurrentSocket(socketIOClient());\nvar id=sessionStorage.getItem('nickname');var room=sessionStorage.getItem('roomName');if(id)setMyID(id);if(room)setRoomName(room);});var myInfo={roomName:roomName,userName:MyID};if(currentSocket){currentSocket.on(\"connect\",function(){currentSocket.emit(\"join\",myInfo);});}//chat owner modal\nvar _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),ChatSettingModalState=_useState8[0],setChatSettingModalState=_useState8[1];var openChatSettingModal=function openChatSettingModal(){setChatSettingModalState(true);};var closeChatSettingModal=function closeChatSettingModal(){setChatSettingModalState(false);};return/*#__PURE__*/_jsx(\"div\",{id:\"App-Container\",children:currentSocket?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"App-Left\",children:/*#__PURE__*/_jsxs(\"div\",{id:\"chat-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-top\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"RoomInfo-num\",children:data===null||data===void 0?void 0:data.num}),/*#__PURE__*/_jsx(\"span\",{children:roomName}),MyPermission==='owner'||MyPermission==='admin'?/*#__PURE__*/_jsx(\"button\",{className:\"setting-btn\",onClick:openChatSettingModal,children:/*#__PURE__*/_jsx(\"img\",{src:setting,width:\"30\",height:\"30\"})}):null]}),/*#__PURE__*/_jsx(ChatSettingModal,{open:ChatSettingModalState,close:closeChatSettingModal,chatRoomID:roomName,MyPermission:MyPermission}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-bottom\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"left-chatLog\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chatLog-top\",children:/*#__PURE__*/_jsx(ChatLog,{socket:currentSocket,MyID:MyID,roomName:roomName})}),/*#__PURE__*/_jsx(\"div\",{className:\"chatLog-bottom\",children:/*#__PURE__*/_jsx(ChatInput,{socket:currentSocket,MyPermission:MyPermission})})]}),/*#__PURE__*/_jsx(\"span\",{className:\"right-chatUser\",children:/*#__PURE__*/_jsx(UserList,{socket:currentSocket,users:data===null||data===void 0?void 0:data.users,MyPermission:MyPermission,getRoomInfoMutate:mutate,roomName:roomName})})]})]})}),/*#__PURE__*/_jsx(\"span\",{className:\"App-Right\",children:/*#__PURE__*/_jsx(SideBar,{})})]}):/*#__PURE__*/_jsx(Loading,{})});};export default Chat;","map":{"version":3,"sources":["/home/sayi/ft/base/client/src/Chat/Chat.tsx"],"names":["React","useEffect","useState","ChatInput","ChatLog","Loading","UserList","SideBar","setting","ChatSettingModal","axios","useSwr","socketIOClient","require","Chat","currentSocket","MyID","setMyID","roomName","setRoomName","MyPermission","setMyPermission","fetcher","url","get","res","data","users","userSorting","error","mutate","userList","rtn","admin","user","i","length","id","permission","push","forEach","ele","sessionStorage","getItem","room","myInfo","userName","on","emit","ChatSettingModalState","setChatSettingModalState","openChatSettingModal","closeChatSettingModal","num"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport ChatInput from \"./ChatInput\";\nimport ChatLog from \"./ChatLog\";\nimport Loading from \"./Loading\";\nimport UserList from \"./UserList\";\nimport SideBar from \"../SideBar/SideBar\";\nimport \"./styles/Chat.scss\"\nimport setting from '../Images/setting.png'\nimport ChatSettingModal from \"./ChatSettingModal\";\nimport axios from \"axios\";\nimport useSwr from 'swr';\nconst socketIOClient = require('socket.io-client')\n\nconst Chat = () => {\n\t\n\tinterface Iuser{\n\t\tid:string,\n\t\tpermission:string,\n\t\ticon:string\n\t}\n\tconst currentSocket = socketIOClient('http://localhost:8080')\n\tconst [MyID, setMyID] = useState('')\n\tconst [roomName, setRoomName] = useState('')\n\tconst [MyPermission, setMyPermission] = useState('')\n\n\tconst fetcher = async (url:string) => {\n\t\tif (roomName)\n\t\t{\n\t\t\tconst res = await axios.get(url)\n\t\t\tres.data.users = userSorting(res.data.users)\n\t\t\treturn res.data;\n\t\t}\n\t}\n\tconst {data, error, mutate} = useSwr<{num:string, security: string, users:Iuser[]}>('/Chat/info?title=' + roomName, fetcher)\n\n\tfunction userSorting(userList:Iuser[])\n\t{\n\t\tvar rtn: Iuser[] = []\n\t\tvar admin: Iuser[] = []\n\t\tvar user: Iuser[] = []\n\n\t\tfor(let i = 0; i < userList.length; i++)\n\t\t{\n\t\t\tif (userList[i].id === MyID)\n\t\t\t\tsetMyPermission(userList[i].permission)\n\t\t\t\n\t\t\tif (userList[i].permission === 'owner')\n\t\t\t\trtn.push(userList[i])\n\t\t\telse if (userList[i].permission === 'admin')\n\t\t\t\tadmin.push(userList[i])\n\t\t\telse\n\t\t\t\tuser.push(userList[i])\n\t\t}\n\t\t\n\t\tadmin.forEach(ele => rtn.push(ele))\n\t\tuser.forEach(ele => rtn.push(ele))\n\t\treturn rtn\n\t}\n\n\tuseEffect(() => {\n\t\t//setCurrentSocket(socketIOClient());\n\t\t\n\t\tconst id = sessionStorage.getItem('nickname')\n\t\tconst room = sessionStorage.getItem('roomName')\n\t\tif (id) setMyID(id)\n\t\tif (room) setRoomName(room)\n\t});\n\t\n\tconst myInfo = {\n\t\troomName: roomName,\n\t\tuserName: MyID,\n\t};\n\n\tif (currentSocket) {\n\t\tcurrentSocket.on(\"connect\", () => {\n\t\t\tcurrentSocket.emit(\"join\", myInfo);\n\t\t});\n\t}\n\n\t\n\n\t//chat owner modal\n\tconst [ChatSettingModalState, setChatSettingModalState] = useState(false);\n\tconst openChatSettingModal = () => {\n\t\tsetChatSettingModalState(true);\n\t}\n\tconst closeChatSettingModal = () => {\n\t\tsetChatSettingModalState(false);\n\t}\n\n\treturn (\n\t<div id=\"App-Container\">\n\t\t{currentSocket ? (\n\t\t<>\n\t\t<span className=\"App-Left\">\n\t\t\t<div id=\"chat-container\">\n\t\t\t<div className=\"chat-top\">\n\t\t\t\t<span className=\"RoomInfo-num\">{data?.num}</span>\n\t\t\t\t<span>{roomName}</span>\n\t\t\t\t{(MyPermission === 'owner' || MyPermission === 'admin')? \n\t\t\t\t\t<button className=\"setting-btn\" onClick={openChatSettingModal}>\n\t\t\t\t\t\t<img src={setting} width=\"30\" height=\"30\"></img>\n\t\t\t\t\t</button>\n\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t</div>\n\t\t\t<ChatSettingModal open={ChatSettingModalState} close={closeChatSettingModal} chatRoomID={roomName} MyPermission={MyPermission}></ChatSettingModal>\n\t\t\t<div className=\"chat-bottom\">\n\t\t\t\t<span className=\"left-chatLog\">\n\t\t\t\t\t<div className=\"chatLog-top\">\n\t\t\t\t\t\t<ChatLog socket={currentSocket} MyID={MyID} roomName={roomName}/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"chatLog-bottom\">\n\t\t\t\t\t\t<ChatInput socket={currentSocket} MyPermission={MyPermission}/>\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t\t<span className=\"right-chatUser\">\n\t\t\t\t\t<UserList socket={currentSocket} users={data?.users} MyPermission={MyPermission} getRoomInfoMutate={mutate} roomName={roomName}></UserList>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t</div>\n\t\t</span>\n\t\t<span className=\"App-Right\">\n\t\t\t\t<SideBar />\n\t\t</span>\n\t\t</>\n\t\t) : (\n\t\t  <Loading></Loading>\n\t\t)}\n\t</div>\n  );\n};\n\nexport default Chat;\n"]},"metadata":{},"sourceType":"module"}