{"ast":null,"code":"var _jsxFileName = \"/Users/sohndohyun/works/transcendence/client/src/Chat/ChatLog.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport \"./styles/ChatLog.scss\";\nimport { findImg } from '../Images/Images';\nimport axios from \"axios\";\nimport useSwr from 'swr';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst ChatLog = ({\n  socket\n}) => {\n  _s();\n\n  const [MyID, setMyID] = useState('');\n  const [roomName, setRoomName] = useState('');\n\n  const fetcher = async url => {\n    if (roomName) {\n      let res = await axios.get(url);\n      const block = await axios.get('profile/allblock?myID=' + MyID);\n      let chatlog = [];\n\n      for (let i = 0; i < res.data.length; i++) {\n        const idx = block.data.blocklist.indexOf(res.data[i].id);\n        if (idx <= -1) chatlog.push(res.data[i]);\n      }\n\n      res.data = chatlog;\n      return res.data;\n    }\n  };\n\n  const {\n    data,\n    error,\n    mutate\n  } = useSwr('/chat/chatLog?title=' + roomName, fetcher);\n  useEffect(() => {\n    const id = sessionStorage.getItem('nickname');\n    const room = sessionStorage.getItem('roomName');\n    if (id) setMyID(id);\n    if (room) setRoomName(room);\n  });\n  useEffect(() => {\n    socket.on(\"onReceive\", async messageItem => {\n      mutate();\n    });\n    return () => {\n      socket.disconnect();\n    };\n  }, [socket]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: data === null || data === void 0 ? void 0 : data.map((msg, idx) => /*#__PURE__*/_jsxDEV(\"div\", {\n      children: msg.sysMsg ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sysMsg\",\n        children: [msg.id, msg.content]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 18\n      }, this) : msg.id === MyID ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"msgRight\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"msg-right\",\n          children: msg.content\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 53,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"msg-timeStamp\",\n          children: [\"(\", msg.date, \")\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 54,\n          columnNumber: 7\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 6\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"msgLeft\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: findImg(msg.icon),\n            width: \"30\",\n            height: \"30\",\n            className: \"msg-icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 58,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 58,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [msg.id && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"msg-userName\",\n            children: msg.id\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 60,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"msg-left\",\n            children: msg.content\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 61,\n            columnNumber: 8\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 59,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"msg-timeStamp\",\n          children: [\"(\", msg.date, \")\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 63,\n          columnNumber: 7\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 6\n      }, this)\n    }, idx, false, {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 3\n    }, this))\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 47,\n    columnNumber: 2\n  }, this);\n};\n\n_s(ChatLog, \"7zT28TG2p9ZG5N+xHb9t99fyCK8=\", false, function () {\n  return [useSwr];\n});\n\n_c = ChatLog;\nexport default ChatLog;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChatLog\");","map":{"version":3,"sources":["/Users/sohndohyun/works/transcendence/client/src/Chat/ChatLog.tsx"],"names":["React","useEffect","useState","findImg","axios","useSwr","ChatLog","socket","MyID","setMyID","roomName","setRoomName","fetcher","url","res","get","block","chatlog","i","data","length","idx","blocklist","indexOf","id","push","error","mutate","sessionStorage","getItem","room","on","messageItem","disconnect","map","msg","sysMsg","content","date","icon"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport \"./styles/ChatLog.scss\";\nimport {findImg} from '../Images/Images'\nimport axios from \"axios\";\nimport useSwr from 'swr';\n\nconst ChatLog = ({socket}: any) => {\n\tconst [MyID, setMyID] = useState('')\n\tconst [roomName, setRoomName] = useState('')\n\n\tconst fetcher = async (url:string) => {\n\t\tif (roomName)\n\t\t{\n\t\t\tlet res = await axios.get(url)\n\n\t\t\tconst block = await axios.get('profile/allblock?myID=' + MyID)\n\t\t\tlet chatlog: {id:string, date:Date, content:string, icon:string, sysMsg:boolean}[] = []\n\t\t\tfor(let i = 0; i < res.data.length; i++)\n\t\t\t{\n\t\t\t\tconst idx = block.data.blocklist.indexOf(res.data[i].id)\n\t\t\t\tif (idx <= -1)\n\t\t\t\t\tchatlog.push(res.data[i])\n\t\t\t}\n\t\t\tres.data = chatlog\n\t\t\treturn res.data;\n\t\t}\n\t}\n\tconst {data, error, mutate} = useSwr<{id:string, date:Date, content:string, icon:string, sysMsg:boolean}[]>('/chat/chatLog?title=' + roomName, fetcher)\n\n\tuseEffect(() => {\n\t\tconst id = sessionStorage.getItem('nickname')\n\t\tconst room = sessionStorage.getItem('roomName')\n\t\tif (id) setMyID(id)\n\t\tif (room) setRoomName(room)\n\t})\n\n\tuseEffect(() => {\n\t\tsocket.on(\"onReceive\", async(messageItem: {nickname:string, msg:string, date:string, icon:string}) => {\n\t\t\tmutate()\n\t\t});\n\t\treturn () => {\n\t\t\tsocket.disconnect();\n\t\t};\n\t}, [socket]);\n\n\treturn (\n\t<div>\n\t\t{data?.map((msg, idx) => (\n\t\t<div key={idx}>\n\t\t\t{msg.sysMsg ? <div className=\"sysMsg\" >{msg.id}{msg.content}</div>\n\t\t\t\t: msg.id === MyID ?\n\t\t\t\t\t<div className=\"msgRight\">\n\t\t\t\t\t\t<span className=\"msg-right\">{msg.content}</span>\n\t\t\t\t\t\t<span className=\"msg-timeStamp\">({msg.date})</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t: \n\t\t\t\t\t<div className=\"msgLeft\">\n\t\t\t\t\t\t<span><img src={findImg(msg.icon)}  width=\"30\" height=\"30\" className=\"msg-icon\"/></span>\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t{msg.id && <div className=\"msg-userName\">{msg.id}</div>}\n\t\t\t\t\t\t\t<div className=\"msg-left\">{msg.content}</div>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span className=\"msg-timeStamp\">({msg.date})</span>\n\t\t\t\t\t</div>\n\t\t\t}\n\t\t</div>\n\t\t))}\n\t</div>\n\t);\n};\n\nexport default ChatLog;"]},"metadata":{},"sourceType":"module"}