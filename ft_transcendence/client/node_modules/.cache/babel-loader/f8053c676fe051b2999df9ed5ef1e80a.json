{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jinkim/jin_bye/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jinkim/jin_bye/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/jinkim/jin_bye/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import\"./styles/ChatLog.scss\";import{findImg}from'../Images/Images';import axios from\"axios\";import useSwr from'swr';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var ChatLog=function ChatLog(_ref){var socket=_ref.socket;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),MyID=_useState2[0],setMyID=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),roomName=_useState4[0],setRoomName=_useState4[1];var fetcher=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(url){var _ret;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!roomName){_context2.next=5;break;}return _context2.delegateYield(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,block,_loop,i;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get(url);case 2:res=_context.sent;_context.next=5;return axios.get('profile/allblock?myID='+MyID);case 5:block=_context.sent;_loop=function _loop(i){console.log(block.data[0]);var isBlocked=block.data.find(function(blocked){if(blocked===res.data[i].id)return true;});console.log('isblock!!!!');console.log(isBlocked);if(isBlocked){var idx=block.data.indexOf(res.data[i].id);console.log('idx!!!!!');console.log(idx);if(idx>-1)res.data=res.data.splice(idx,1);}};for(i=0;i<res.data.length;i++){_loop(i);}return _context.abrupt(\"return\",{v:res.data});case 9:case\"end\":return _context.stop();}}},_callee);})(),\"t0\",2);case 2:_ret=_context2.t0;if(!(typeof _ret===\"object\")){_context2.next=5;break;}return _context2.abrupt(\"return\",_ret.v);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function fetcher(_x){return _ref2.apply(this,arguments);};}();var _useSwr=useSwr('/chat/chatLog?title='+roomName,fetcher),data=_useSwr.data,error=_useSwr.error,mutate=_useSwr.mutate;useEffect(function(){var id=sessionStorage.getItem('nickname');var room=sessionStorage.getItem('roomName');if(id)setMyID(id);if(room)setRoomName(room);});useEffect(function(){socket.on(\"onReceive\",/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(messageItem){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:mutate();case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x2){return _ref3.apply(this,arguments);};}());return function(){socket.disconnect();};},[socket]);return/*#__PURE__*/_jsx(\"div\",{children:data===null||data===void 0?void 0:data.map(function(msg,idx){return/*#__PURE__*/_jsx(\"div\",{children:msg.sysMsg?/*#__PURE__*/_jsxs(\"div\",{className:\"sysMsg\",children:[msg.id,msg.content]}):msg.id===MyID?/*#__PURE__*/_jsxs(\"div\",{className:\"msgRight\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"msg-right\",children:msg.content}),/*#__PURE__*/_jsxs(\"span\",{className:\"msg-timeStamp\",children:[\"(\",msg.date,\")\"]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"msgLeft\",children:[/*#__PURE__*/_jsx(\"span\",{children:/*#__PURE__*/_jsx(\"img\",{src:findImg(msg.icon),width:\"30\",height:\"30\",className:\"msg-icon\"})}),/*#__PURE__*/_jsxs(\"span\",{children:[msg.id&&/*#__PURE__*/_jsx(\"div\",{className:\"msg-userName\",children:msg.id}),/*#__PURE__*/_jsx(\"div\",{className:\"msg-left\",children:msg.content})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"msg-timeStamp\",children:[\"(\",msg.date,\")\"]})]})},idx);})});};export default ChatLog;","map":{"version":3,"sources":["/Users/jinkim/jin_bye/client/src/Chat/ChatLog.tsx"],"names":["React","useEffect","useState","findImg","axios","useSwr","ChatLog","socket","MyID","setMyID","roomName","setRoomName","fetcher","url","get","res","block","i","console","log","data","isBlocked","find","blocked","id","idx","indexOf","splice","length","error","mutate","sessionStorage","getItem","room","on","messageItem","disconnect","map","msg","sysMsg","content","date","icon"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport \"./styles/ChatLog.scss\";\nimport {findImg} from '../Images/Images'\nimport axios from \"axios\";\nimport useSwr from 'swr';\n\nconst ChatLog = ({socket}: any) => {\n\tconst [MyID, setMyID] = useState('')\n\tconst [roomName, setRoomName] = useState('')\n\n\tconst fetcher = async (url:string) => {\n\t\tif (roomName)\n\t\t{\n\t\t\tlet res = await axios.get(url)\n\n\t\t\tconst block = await axios.get('profile/allblock?myID=' + MyID)\n\t\t\tfor(let i = 0; i < res.data.length; i++)\n\t\t\t{\n\t\t\t\tconsole.log(block.data[0])\n\t\t\t\tconst isBlocked = block.data.find((blocked: string) => {\n\t\t\t\t\tif (blocked === res.data[i].id)\n\t\t\t\t\t\treturn true\n\t\t\t\t})\n\t\t\t\tconsole.log('isblock!!!!')\n\t\t\t\tconsole.log(isBlocked)\n\t\t\t\tif (isBlocked)\n\t\t\t\t{\n\t\t\t\t\tconst idx = block.data.indexOf(res.data[i].id)\n\t\t\t\t\tconsole.log('idx!!!!!')\n\t\t\t\t\tconsole.log(idx)\n\t\t\t\t\tif (idx > -1)\n\t\t\t\t\t\tres.data = res.data.splice(idx, 1)\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn res.data;\n\t\t}\n\t}\n\tconst {data, error, mutate} = useSwr<{id:string, date:Date, content:string, icon:string, sysMsg:boolean}[]>('/chat/chatLog?title=' + roomName, fetcher)\n\n\tuseEffect(() => {\n\t\tconst id = sessionStorage.getItem('nickname')\n\t\tconst room = sessionStorage.getItem('roomName')\n\t\tif (id) setMyID(id)\n\t\tif (room) setRoomName(room)\n\t})\n\n\tuseEffect(() => {\n\t\tsocket.on(\"onReceive\", async(messageItem: {nickname:string, msg:string, date:string, icon:string}) => {\n\t\t\tmutate()\n\t\t});\n\t\treturn () => {\n\t\t\tsocket.disconnect();\n\t\t};\n\t}, [socket]);\n\n\treturn (\n\t<div>\n\t\t{data?.map((msg, idx) => (\n\t\t<div key={idx}>\n\t\t\t{msg.sysMsg ? <div className=\"sysMsg\" >{msg.id}{msg.content}</div>\n\t\t\t\t: msg.id === MyID ?\n\t\t\t\t\t<div className=\"msgRight\">\n\t\t\t\t\t\t<span className=\"msg-right\">{msg.content}</span>\n\t\t\t\t\t\t<span className=\"msg-timeStamp\">({msg.date})</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t: \n\t\t\t\t\t<div className=\"msgLeft\">\n\t\t\t\t\t\t<span><img src={findImg(msg.icon)}  width=\"30\" height=\"30\" className=\"msg-icon\"/></span>\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t{msg.id && <div className=\"msg-userName\">{msg.id}</div>}\n\t\t\t\t\t\t\t<div className=\"msg-left\">{msg.content}</div>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span className=\"msg-timeStamp\">({msg.date})</span>\n\t\t\t\t\t</div>\n\t\t\t}\n\t\t</div>\n\t\t))}\n\t</div>\n\t);\n};\n\nexport default ChatLog;"]},"metadata":{},"sourceType":"module"}