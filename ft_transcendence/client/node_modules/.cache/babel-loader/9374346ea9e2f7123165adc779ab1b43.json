{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sohndohyun/works/transcendence/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sohndohyun/works/transcendence/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/sohndohyun/works/transcendence/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import ChatInput from\"./ChatInput\";import ChatLog from\"./ChatLog\";import Loading from\"./Loading\";import UserList from\"./UserList\";import SideBar from\"../SideBar/SideBar\";import\"./styles/Chat.scss\";import setting from'../Images/setting.png';import ChatSettingModal from\"./ChatSettingModal\";import axios from\"axios\";import useSwr from'swr';import Game from'../Pong/Game';import socket from'../Pong/PongSocket';import GameResult from'../Lobby/GameResult';import MatchFailedModal from'../Lobby/MatchFailedModal';import DirectGameModal from'../SideBar/DirectGameModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var socketIOClient=require('socket.io-client');var aname='a';var bname='b';var dr=0;var sbool=false;var lbool=false;var name;var Chat=function Chat(){var currentSocket=socketIOClient('http://localhost:8080');var _useState=useState(''),_useState2=_slicedToArray(_useState,2),MyID=_useState2[0],setMyID=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),roomName=_useState4[0],setRoomName=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),MyPermission=_useState6[0],setMyPermission=_useState6[1];var fetcher=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(url){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!roomName){_context.next=6;break;}_context.next=3;return axios.get(url);case 3:res=_context.sent;res.data.users=userSorting(res.data.users);return _context.abrupt(\"return\",res.data);case 6:case\"end\":return _context.stop();}}},_callee);}));return function fetcher(_x){return _ref.apply(this,arguments);};}();var _useSwr=useSwr('/Chat/info?title='+roomName,fetcher),data=_useSwr.data,error=_useSwr.error,mutate=_useSwr.mutate;function userSorting(userList){var rtn=[];var admin=[];var user=[];for(var i=0;i<userList.length;i++){if(userList[i].id===MyID)setMyPermission(userList[i].permission);if(userList[i].permission==='owner')rtn.push(userList[i]);else if(userList[i].permission==='admin')admin.push(userList[i]);else user.push(userList[i]);}admin.forEach(function(ele){return rtn.push(ele);});user.forEach(function(ele){return rtn.push(ele);});return rtn;}useEffect(function(){//setCurrentSocket(socketIOClient());\nvar id=sessionStorage.getItem('nickname');var room=sessionStorage.getItem('roomName');if(id)setMyID(id);if(room)setRoomName(room);var gameTarget=sessionStorage.getItem('directGame');if(gameTarget){setDirectGameTarget(gameTarget);openDirectGameModal();sessionStorage.removeItem('directGame');}});var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),connected=_useState8[0],setConnected=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),matched=_useState10[0],setMatched=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),MatchFailed=_useState12[0],setMatchFailed=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),DirectGameTarget=_useState14[0],setDirectGameTarget=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),gameResult=_useState16[0],setGameResult=_useState16[1];useEffect(function(){if(connected&&MyID){socket.emit('Con',MyID);}socket.emit('GameList');},[connected,MyID]);useEffect(function(){socket.on('connect',function(){setConnected(true);});socket.on('disconnect',function(){setConnected(false);});socket.on('match_failed',function(){setMatchFailed(true);});socket.on('matched',function(e){aname=e.a;bname=e.b;dr=e.dr;sbool=e.speed;lbool=e.ladder;setMatched(true);});socket.on('finish',function(e){name=e===0?aname:bname;setMatched(false);setGameResult(true);});});//gameresult modal\nvar closeGameResult=function closeGameResult(){return setGameResult(false);};//direct game modal\nvar _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),DirectGameModalState=_useState18[0],setDirectGameModalState=_useState18[1];var openDirectGameModal=function openDirectGameModal(){setDirectGameModalState(true);};var closeDirectGameModal=function closeDirectGameModal(){setDirectGameModalState(false);};//match failed modal\nvar closeMatchFailedModal=function closeMatchFailedModal(){setMatchFailed(false);if(DirectGameModalState)closeDirectGameModal();};var myInfo={roomName:roomName,userName:MyID};if(currentSocket){currentSocket.on(\"connect\",function(){currentSocket.emit(\"join\",myInfo);});}//chat owner modal\nvar _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),ChatSettingModalState=_useState20[0],setChatSettingModalState=_useState20[1];var openChatSettingModal=function openChatSettingModal(){setChatSettingModalState(true);};var closeChatSettingModal=function closeChatSettingModal(){setChatSettingModalState(false);};return matched?/*#__PURE__*/_jsxs(\"div\",{id:\"App-Container\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"App-Left\",children:/*#__PURE__*/_jsx(Game,{a:aname,b:bname,dr:dr,speed:sbool,ladder:lbool})}),/*#__PURE__*/_jsx(\"span\",{className:\"App-Right\",children:/*#__PURE__*/_jsx(SideBar,{})}),/*#__PURE__*/_jsx(MatchFailedModal,{open:MatchFailed,close:closeMatchFailedModal})]}):/*#__PURE__*/_jsx(\"div\",{id:\"App-Container\",children:currentSocket?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"App-Left\",children:/*#__PURE__*/_jsxs(\"div\",{id:\"chat-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-top\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"RoomInfo-num\",children:data===null||data===void 0?void 0:data.num}),/*#__PURE__*/_jsx(\"span\",{children:roomName}),MyPermission==='owner'||MyPermission==='admin'?/*#__PURE__*/_jsx(\"button\",{className:\"setting-btn\",onClick:openChatSettingModal,children:/*#__PURE__*/_jsx(\"img\",{src:setting,width:\"30\",height:\"30\"})}):null]}),/*#__PURE__*/_jsx(ChatSettingModal,{open:ChatSettingModalState,close:closeChatSettingModal,chatRoomID:roomName,MyPermission:MyPermission}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-bottom\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"left-chatLog\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chatLog-top\",children:/*#__PURE__*/_jsx(ChatLog,{socket:currentSocket,MyID:MyID,roomName:roomName})}),/*#__PURE__*/_jsx(\"div\",{className:\"chatLog-bottom\",children:/*#__PURE__*/_jsx(ChatInput,{socket:currentSocket,MyPermission:MyPermission})})]}),/*#__PURE__*/_jsx(\"span\",{className:\"right-chatUser\",children:/*#__PURE__*/_jsx(UserList,{socket:currentSocket,users:data===null||data===void 0?void 0:data.users,MyPermission:MyPermission,getRoomInfoMutate:mutate,roomName:roomName})})]})]})}),/*#__PURE__*/_jsx(\"span\",{className:\"App-Right\",children:/*#__PURE__*/_jsx(SideBar,{})}),/*#__PURE__*/_jsx(GameResult,{name:name,open:gameResult,close:closeGameResult}),/*#__PURE__*/_jsx(DirectGameModal,{open:DirectGameModalState,close:closeDirectGameModal,targetID:DirectGameTarget,closeUserInfoModal:null}),/*#__PURE__*/_jsx(MatchFailedModal,{open:MatchFailed,close:closeMatchFailedModal})]}):/*#__PURE__*/_jsx(Loading,{})});};export default Chat;","map":{"version":3,"sources":["/Users/sohndohyun/works/transcendence/client/src/Chat/Chat.tsx"],"names":["React","useEffect","useState","ChatInput","ChatLog","Loading","UserList","SideBar","setting","ChatSettingModal","axios","useSwr","Game","socket","GameResult","MatchFailedModal","DirectGameModal","socketIOClient","require","aname","bname","dr","sbool","lbool","name","Chat","currentSocket","MyID","setMyID","roomName","setRoomName","MyPermission","setMyPermission","fetcher","url","get","res","data","users","userSorting","error","mutate","userList","rtn","admin","user","i","length","id","permission","push","forEach","ele","sessionStorage","getItem","room","gameTarget","setDirectGameTarget","openDirectGameModal","removeItem","connected","setConnected","matched","setMatched","MatchFailed","setMatchFailed","DirectGameTarget","gameResult","setGameResult","emit","on","e","a","b","speed","ladder","closeGameResult","DirectGameModalState","setDirectGameModalState","closeDirectGameModal","closeMatchFailedModal","myInfo","userName","ChatSettingModalState","setChatSettingModalState","openChatSettingModal","closeChatSettingModal","num"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport ChatInput from \"./ChatInput\";\nimport ChatLog from \"./ChatLog\";\nimport Loading from \"./Loading\";\nimport UserList from \"./UserList\";\nimport SideBar from \"../SideBar/SideBar\";\nimport \"./styles/Chat.scss\"\nimport setting from '../Images/setting.png'\nimport ChatSettingModal from \"./ChatSettingModal\";\nimport axios from \"axios\";\nimport useSwr from 'swr';\n\nimport Game from '../Pong/Game';\nimport socket from '../Pong/PongSocket';\nimport GameResult from '../Lobby/GameResult';\nimport { MatchData } from \"../Lobby/Lobby\";\nimport MatchFailedModal from '../Lobby/MatchFailedModal'\nimport DirectGameModal from '../SideBar/DirectGameModal';\n\nconst socketIOClient = require('socket.io-client')\n\nlet aname = 'a';\nlet bname = 'b';\nlet dr = 0;\nlet sbool = false;\nlet lbool = false;\nlet name: string;\n\nconst Chat = () => {\n\t\n\tinterface Iuser{\n\t\tid:string,\n\t\tpermission:string,\n\t\ticon:string\n\t}\n\tconst currentSocket = socketIOClient('http://localhost:8080')\n\tconst [MyID, setMyID] = useState('')\n\tconst [roomName, setRoomName] = useState('')\n\tconst [MyPermission, setMyPermission] = useState('')\n\n\tconst fetcher = async (url:string) => {\n\t\tif (roomName)\n\t\t{\n\t\t\tconst res = await axios.get(url)\n\t\t\tres.data.users = userSorting(res.data.users)\n\t\t\treturn res.data;\n\t\t}\n\t}\n\tconst {data, error, mutate} = useSwr<{num:string, security: string, users:Iuser[]}>('/Chat/info?title=' + roomName, fetcher)\n\n\tfunction userSorting(userList:Iuser[])\n\t{\n\t\tvar rtn: Iuser[] = []\n\t\tvar admin: Iuser[] = []\n\t\tvar user: Iuser[] = []\n\n\t\tfor(let i = 0; i < userList.length; i++)\n\t\t{\n\t\t\tif (userList[i].id === MyID)\n\t\t\t\tsetMyPermission(userList[i].permission)\n\t\t\t\n\t\t\tif (userList[i].permission === 'owner')\n\t\t\t\trtn.push(userList[i])\n\t\t\telse if (userList[i].permission === 'admin')\n\t\t\t\tadmin.push(userList[i])\n\t\t\telse\n\t\t\t\tuser.push(userList[i])\n\t\t}\n\t\t\n\t\tadmin.forEach(ele => rtn.push(ele))\n\t\tuser.forEach(ele => rtn.push(ele))\n\t\treturn rtn\n\t}\n\n\tuseEffect(() => {\n\t\t//setCurrentSocket(socketIOClient());\n\t\t\n\t\tconst id = sessionStorage.getItem('nickname')\n\t\tconst room = sessionStorage.getItem('roomName')\n\t\tif (id) setMyID(id)\n\t\tif (room) setRoomName(room)\n\n\t\tconst gameTarget = sessionStorage.getItem('directGame');\n    \tif (gameTarget) {\n      \t\tsetDirectGameTarget(gameTarget);\n      \t\topenDirectGameModal();\n      \t\tsessionStorage.removeItem('directGame');\n    \t}\n\t});\n\n\n\tconst [connected, setConnected] = useState(false);\n \tconst [matched, setMatched] = useState(false);\n\tconst [MatchFailed, setMatchFailed] = useState(false);\n\tconst [DirectGameTarget, setDirectGameTarget] = useState('');\n\tconst [gameResult, setGameResult] = useState(false);\n\n\tuseEffect(() => {\n\t\tif (connected && MyID) {\n\t\t  socket.emit('Con', MyID);\n\t\t}\n\t\tsocket.emit('GameList');\n\t  }, [connected, MyID]);\n\t\n\t  useEffect(() => {\n\t\tsocket.on('connect', () => {\n\t\t  setConnected(true);\n\t\t});\n\t\n\t\tsocket.on('disconnect', () => {\n\t\t  setConnected(false);\n\t\t});\n\t\n\t\tsocket.on('match_failed', () => {\n\t\t\tsetMatchFailed(true)\n\t\t});\n\t\n\t\tsocket.on('matched', (e: MatchData) => {\n\t\t  aname = e.a;\n\t\t  bname = e.b;\n\t\t  dr = e.dr;\n\t\t  sbool = e.speed;\n\t\t  lbool = e.ladder;\n\t\t  setMatched(true);\n\t\t});\n\t\n\t\tsocket.on('finish', (e: number) => {\n\t\t  name = e === 0 ? aname : bname;\n\t\t  setMatched(false);\n\t\t  setGameResult(true);\n\t\t});\n\t  });\n\n\t//gameresult modal\n\tconst closeGameResult = () => setGameResult(false);\n\n\t//direct game modal\n\tconst [DirectGameModalState, setDirectGameModalState] = useState(false);\n\tconst openDirectGameModal = () => {\n\t  setDirectGameModalState(true);\n\t};\n\tconst closeDirectGameModal = () => {\n\t  setDirectGameModalState(false);\n\t};\n  \n\t//match failed modal\n\tconst closeMatchFailedModal = () => {\n\t\tsetMatchFailed(false)\n\t\tif (DirectGameModalState) closeDirectGameModal();\n\t}\n\n\t\n\tconst myInfo = {\n\t\troomName: roomName,\n\t\tuserName: MyID,\n\t};\n\n\tif (currentSocket) {\n\t\tcurrentSocket.on(\"connect\", () => {\n\t\t\tcurrentSocket.emit(\"join\", myInfo);\n\t\t});\n\t}\n\n\t\n\n\t//chat owner modal\n\tconst [ChatSettingModalState, setChatSettingModalState] = useState(false);\n\tconst openChatSettingModal = () => {\n\t\tsetChatSettingModalState(true);\n\t}\n\tconst closeChatSettingModal = () => {\n\t\tsetChatSettingModalState(false);\n\t}\n\n\treturn (matched ? (\n\t\t<div id=\"App-Container\">\n\t\t  <span className=\"App-Left\">\n\t\t\t<Game a={aname} b={bname} dr={dr} speed={sbool} ladder={lbool} />\n\t\t  </span>\n\t\t  <span className=\"App-Right\">\n\t\t\t<SideBar />\n\t\t  </span>\n\t\t  <MatchFailedModal open={MatchFailed} close={closeMatchFailedModal} />\n\t\t</div>\n\t  ) : (\n\t<div id=\"App-Container\">\n\t\t{currentSocket ? (\n\t\t<>\n\t\t<span className=\"App-Left\">\n\t\t\t<div id=\"chat-container\">\n\t\t\t<div className=\"chat-top\">\n\t\t\t\t<span className=\"RoomInfo-num\">{data?.num}</span>\n\t\t\t\t<span>{roomName}</span>\n\t\t\t\t{(MyPermission === 'owner' || MyPermission === 'admin')? \n\t\t\t\t\t<button className=\"setting-btn\" onClick={openChatSettingModal}>\n\t\t\t\t\t\t<img src={setting} width=\"30\" height=\"30\"></img>\n\t\t\t\t\t</button>\n\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t</div>\n\t\t\t<ChatSettingModal open={ChatSettingModalState} close={closeChatSettingModal} chatRoomID={roomName} MyPermission={MyPermission}></ChatSettingModal>\n\t\t\t<div className=\"chat-bottom\">\n\t\t\t\t<span className=\"left-chatLog\">\n\t\t\t\t\t<div className=\"chatLog-top\">\n\t\t\t\t\t\t<ChatLog socket={currentSocket} MyID={MyID} roomName={roomName}/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"chatLog-bottom\">\n\t\t\t\t\t\t<ChatInput socket={currentSocket} MyPermission={MyPermission}/>\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t\t<span className=\"right-chatUser\">\n\t\t\t\t\t<UserList socket={currentSocket} users={data?.users} MyPermission={MyPermission} getRoomInfoMutate={mutate} roomName={roomName}></UserList>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t</div>\n\t\t</span>\n\t\t<span className=\"App-Right\">\n\t\t\t\t<SideBar />\n\t\t</span> \n\t\t<GameResult name={name} open={gameResult} close={closeGameResult} />\n      <DirectGameModal\n        open={DirectGameModalState}\n        close={closeDirectGameModal}\n        targetID={DirectGameTarget}\n        closeUserInfoModal={null}\n      />\n\t  <MatchFailedModal open={MatchFailed} close={closeMatchFailedModal} />\n\t\t</>\n\t\t) : (\n\t\t  <Loading></Loading>\n\t\t)}\n\t</div>\n  ));\n};\n\nexport default Chat;\n"]},"metadata":{},"sourceType":"module"}