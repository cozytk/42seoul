{"ast":null,"code":"var _jsxFileName = \"/Users/sohndohyun/works/transcendence/client/src/Chat/Chat.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport ChatInput from \"./ChatInput\";\nimport ChatLog from \"./ChatLog\";\nimport Loading from \"./Loading\";\nimport UserList from \"./UserList\";\nimport SideBar from \"../SideBar/SideBar\";\nimport \"./styles/Chat.scss\";\nimport setting from '../Images/setting.png';\nimport ChatSettingModal from \"./ChatSettingModal\";\nimport axios from \"axios\";\nimport useSwr from 'swr';\nimport Game from '../Pong/Game';\nimport socket from '../Pong/PongSocket';\nimport MatchFailedModal from '../Lobby/MatchFailedModal';\nimport DirectGameModal from '../SideBar/DirectGameModal';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst socketIOClient = require('socket.io-client');\n\nlet aname = 'a';\nlet bname = 'b';\nlet dr = 0;\nlet sbool = false;\nlet lbool = false;\nlet name;\n\nconst Chat = () => {\n  _s();\n\n  const currentSocket = socketIOClient('http://localhost:8080');\n  const [MyID, setMyID] = useState('');\n  const [roomName, setRoomName] = useState('');\n  const [MyPermission, setMyPermission] = useState('');\n\n  const fetcher = async url => {\n    if (roomName) {\n      const res = await axios.get(url);\n      res.data.users = userSorting(res.data.users);\n      return res.data;\n    }\n  };\n\n  const {\n    data,\n    error,\n    mutate\n  } = useSwr('/Chat/info?title=' + roomName, fetcher);\n\n  function userSorting(userList) {\n    var rtn = [];\n    var admin = [];\n    var user = [];\n\n    for (let i = 0; i < userList.length; i++) {\n      if (userList[i].id === MyID) setMyPermission(userList[i].permission);\n      if (userList[i].permission === 'owner') rtn.push(userList[i]);else if (userList[i].permission === 'admin') admin.push(userList[i]);else user.push(userList[i]);\n    }\n\n    admin.forEach(ele => rtn.push(ele));\n    user.forEach(ele => rtn.push(ele));\n    return rtn;\n  }\n\n  useEffect(() => {\n    //setCurrentSocket(socketIOClient());\n    const id = sessionStorage.getItem('nickname');\n    const room = sessionStorage.getItem('roomName');\n    if (id) setMyID(id);\n    if (room) setRoomName(room);\n    const gameTarget = sessionStorage.getItem('directGame');\n\n    if (gameTarget) {\n      setDirectGameTarget(gameTarget);\n      openDirectGameModal();\n      sessionStorage.removeItem('directGame');\n    }\n  });\n  const [connected, setConnected] = useState(false);\n  const [matched, setMatched] = useState(false);\n  const [MatchFailed, setMatchFailed] = useState(false);\n  const [DirectGameTarget, setDirectGameTarget] = useState('');\n  const [gameResult, setGameResult] = useState(false);\n  useEffect(() => {\n    if (connected && MyID) {\n      socket.emit('Con', MyID);\n    }\n\n    socket.emit('GameList');\n  }, [connected, MyID]);\n  useEffect(() => {\n    socket.on('connect', () => {\n      setConnected(true);\n    });\n    socket.on('disconnect', () => {\n      setConnected(false);\n    });\n    socket.on('match_failed', () => {\n      setMatchFailed(true);\n    });\n    socket.on('matched', e => {\n      aname = e.a;\n      bname = e.b;\n      dr = e.dr;\n      sbool = e.speed;\n      lbool = e.ladder;\n      setMatched(true);\n    });\n    socket.on('finish', e => {\n      name = e === 0 ? aname : bname;\n      setMatched(false);\n      setGameResult(true);\n    });\n  }); //gameresult modal\n\n  const closeGameResult = () => setGameResult(false); //direct game modal\n\n\n  const [DirectGameModalState, setDirectGameModalState] = useState(false);\n\n  const openDirectGameModal = () => {\n    setDirectGameModalState(true);\n  };\n\n  const closeDirectGameModal = () => {\n    setDirectGameModalState(false);\n  }; //match failed modal\n\n\n  const closeMatchFailedModal = () => {\n    setMatchFailed(false);\n    if (DirectGameModalState) closeDirectGameModal();\n  };\n\n  const myInfo = {\n    roomName: roomName,\n    userName: MyID\n  };\n\n  if (currentSocket) {\n    currentSocket.on(\"connect\", () => {\n      currentSocket.emit(\"join\", myInfo);\n    });\n  } //chat owner modal\n\n\n  const [ChatSettingModalState, setChatSettingModalState] = useState(false);\n\n  const openChatSettingModal = () => {\n    setChatSettingModalState(true);\n  };\n\n  const closeChatSettingModal = () => {\n    setChatSettingModalState(false);\n  };\n\n  return matched ? /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"App-Container\",\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"App-Left\",\n      children: /*#__PURE__*/_jsxDEV(Game, {\n        a: aname,\n        b: bname,\n        dr: dr,\n        speed: sbool,\n        ladder: lbool\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 4\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"App-Right\",\n      children: /*#__PURE__*/_jsxDEV(SideBar, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 4\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(MatchFailedModal, {\n      open: MatchFailed,\n      close: closeMatchFailedModal\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 176,\n    columnNumber: 3\n  }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"App-Container\",\n    children: currentSocket ? /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"App-Left\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"chat-container\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-top\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"RoomInfo-num\",\n              children: data === null || data === void 0 ? void 0 : data.num\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 192,\n              columnNumber: 5\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: roomName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 193,\n              columnNumber: 5\n            }, this), MyPermission === 'owner' || MyPermission === 'admin' ? /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"setting-btn\",\n              onClick: openChatSettingModal,\n              children: /*#__PURE__*/_jsxDEV(\"img\", {\n                src: setting,\n                width: \"30\",\n                height: \"30\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 196,\n                columnNumber: 7\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 195,\n              columnNumber: 6\n            }, this) : null]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 4\n          }, this), /*#__PURE__*/_jsxDEV(ChatSettingModal, {\n            open: ChatSettingModalState,\n            close: closeChatSettingModal,\n            chatRoomID: roomName,\n            MyPermission: MyPermission\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 4\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-bottom\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"left-chatLog\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"chatLog-top\",\n                children: /*#__PURE__*/_jsxDEV(ChatLog, {\n                  socket: currentSocket,\n                  MyID: MyID,\n                  roomName: roomName\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 205,\n                  columnNumber: 7\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 204,\n                columnNumber: 6\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"chatLog-bottom\",\n                children: /*#__PURE__*/_jsxDEV(ChatInput, {\n                  socket: currentSocket,\n                  MyPermission: MyPermission\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 208,\n                  columnNumber: 7\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 207,\n                columnNumber: 6\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 203,\n              columnNumber: 5\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"right-chatUser\",\n              children: /*#__PURE__*/_jsxDEV(UserList, {\n                socket: currentSocket,\n                users: data === null || data === void 0 ? void 0 : data.users,\n                MyPermission: MyPermission,\n                getRoomInfoMutate: mutate,\n                roomName: roomName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 212,\n                columnNumber: 6\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 211,\n              columnNumber: 5\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 202,\n            columnNumber: 4\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 4\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 3\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"App-Right\",\n        children: /*#__PURE__*/_jsxDEV(SideBar, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 3\n      }, this), /*#__PURE__*/_jsxDEV(DirectGameModal, {\n        open: DirectGameModalState,\n        close: closeDirectGameModal,\n        targetID: DirectGameTarget,\n        closeUserInfoModal: null\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(MatchFailedModal, {\n        open: MatchFailed,\n        close: closeMatchFailedModal\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 4\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 3\n    }, this) : /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 5\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 186,\n    columnNumber: 2\n  }, this);\n};\n\n_s(Chat, \"bqkjzmyxwwdV6BrkwqZ/Xr1dvJs=\", false, function () {\n  return [useSwr];\n});\n\n_c = Chat;\nexport default Chat;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"sources":["/Users/sohndohyun/works/transcendence/client/src/Chat/Chat.tsx"],"names":["React","useEffect","useState","ChatInput","ChatLog","Loading","UserList","SideBar","setting","ChatSettingModal","axios","useSwr","Game","socket","MatchFailedModal","DirectGameModal","socketIOClient","require","aname","bname","dr","sbool","lbool","name","Chat","currentSocket","MyID","setMyID","roomName","setRoomName","MyPermission","setMyPermission","fetcher","url","res","get","data","users","userSorting","error","mutate","userList","rtn","admin","user","i","length","id","permission","push","forEach","ele","sessionStorage","getItem","room","gameTarget","setDirectGameTarget","openDirectGameModal","removeItem","connected","setConnected","matched","setMatched","MatchFailed","setMatchFailed","DirectGameTarget","gameResult","setGameResult","emit","on","e","a","b","speed","ladder","closeGameResult","DirectGameModalState","setDirectGameModalState","closeDirectGameModal","closeMatchFailedModal","myInfo","userName","ChatSettingModalState","setChatSettingModalState","openChatSettingModal","closeChatSettingModal","num"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport ChatInput from \"./ChatInput\";\nimport ChatLog from \"./ChatLog\";\nimport Loading from \"./Loading\";\nimport UserList from \"./UserList\";\nimport SideBar from \"../SideBar/SideBar\";\nimport \"./styles/Chat.scss\"\nimport setting from '../Images/setting.png'\nimport ChatSettingModal from \"./ChatSettingModal\";\nimport axios from \"axios\";\nimport useSwr from 'swr';\n\nimport Game from '../Pong/Game';\nimport socket from '../Pong/PongSocket';\nimport GameResult from '../Lobby/GameResult';\nimport { MatchData } from \"../Lobby/Lobby\";\nimport MatchFailedModal from '../Lobby/MatchFailedModal'\nimport DirectGameModal from '../SideBar/DirectGameModal';\n\nconst socketIOClient = require('socket.io-client')\n\nlet aname = 'a';\nlet bname = 'b';\nlet dr = 0;\nlet sbool = false;\nlet lbool = false;\nlet name: string;\n\nconst Chat = () => {\n\t\n\tinterface Iuser{\n\t\tid:string,\n\t\tpermission:string,\n\t\ticon:string\n\t}\n\tconst currentSocket = socketIOClient('http://localhost:8080')\n\tconst [MyID, setMyID] = useState('')\n\tconst [roomName, setRoomName] = useState('')\n\tconst [MyPermission, setMyPermission] = useState('')\n\n\tconst fetcher = async (url:string) => {\n\t\tif (roomName)\n\t\t{\n\t\t\tconst res = await axios.get(url)\n\t\t\tres.data.users = userSorting(res.data.users)\n\t\t\treturn res.data;\n\t\t}\n\t}\n\tconst {data, error, mutate} = useSwr<{num:string, security: string, users:Iuser[]}>('/Chat/info?title=' + roomName, fetcher)\n\n\tfunction userSorting(userList:Iuser[])\n\t{\n\t\tvar rtn: Iuser[] = []\n\t\tvar admin: Iuser[] = []\n\t\tvar user: Iuser[] = []\n\n\t\tfor(let i = 0; i < userList.length; i++)\n\t\t{\n\t\t\tif (userList[i].id === MyID)\n\t\t\t\tsetMyPermission(userList[i].permission)\n\t\t\t\n\t\t\tif (userList[i].permission === 'owner')\n\t\t\t\trtn.push(userList[i])\n\t\t\telse if (userList[i].permission === 'admin')\n\t\t\t\tadmin.push(userList[i])\n\t\t\telse\n\t\t\t\tuser.push(userList[i])\n\t\t}\n\t\t\n\t\tadmin.forEach(ele => rtn.push(ele))\n\t\tuser.forEach(ele => rtn.push(ele))\n\t\treturn rtn\n\t}\n\n\tuseEffect(() => {\n\t\t//setCurrentSocket(socketIOClient());\n\t\t\n\t\tconst id = sessionStorage.getItem('nickname')\n\t\tconst room = sessionStorage.getItem('roomName')\n\t\tif (id) setMyID(id)\n\t\tif (room) setRoomName(room)\n\n\t\tconst gameTarget = sessionStorage.getItem('directGame');\n    \tif (gameTarget) {\n      \t\tsetDirectGameTarget(gameTarget);\n      \t\topenDirectGameModal();\n      \t\tsessionStorage.removeItem('directGame');\n    \t}\n\t});\n\n\n\tconst [connected, setConnected] = useState(false);\n \tconst [matched, setMatched] = useState(false);\n\tconst [MatchFailed, setMatchFailed] = useState(false);\n\tconst [DirectGameTarget, setDirectGameTarget] = useState('');\n\tconst [gameResult, setGameResult] = useState(false);\n\n\tuseEffect(() => {\n\t\tif (connected && MyID) {\n\t\t  socket.emit('Con', MyID);\n\t\t}\n\t\tsocket.emit('GameList');\n\t  }, [connected, MyID]);\n\t\n\t  useEffect(() => {\n\t\tsocket.on('connect', () => {\n\t\t  setConnected(true);\n\t\t});\n\t\n\t\tsocket.on('disconnect', () => {\n\t\t  setConnected(false);\n\t\t});\n\t\n\t\tsocket.on('match_failed', () => {\n\t\t\tsetMatchFailed(true)\n\t\t});\n\t\n\t\tsocket.on('matched', (e: MatchData) => {\n\t\t  aname = e.a;\n\t\t  bname = e.b;\n\t\t  dr = e.dr;\n\t\t  sbool = e.speed;\n\t\t  lbool = e.ladder;\n\t\t  setMatched(true);\n\t\t});\n\t\n\t\tsocket.on('finish', (e: number) => {\n\t\t  name = e === 0 ? aname : bname;\n\t\t  setMatched(false);\n\t\t  setGameResult(true);\n\t\t});\n\t  });\n\n\t//gameresult modal\n\tconst closeGameResult = () => setGameResult(false);\n\n\t//direct game modal\n\tconst [DirectGameModalState, setDirectGameModalState] = useState(false);\n\tconst openDirectGameModal = () => {\n\t  setDirectGameModalState(true);\n\t};\n\tconst closeDirectGameModal = () => {\n\t  setDirectGameModalState(false);\n\t};\n  \n\t//match failed modal\n\tconst closeMatchFailedModal = () => {\n\t\tsetMatchFailed(false)\n\t\tif (DirectGameModalState) closeDirectGameModal();\n\t}\n\n\t\n\tconst myInfo = {\n\t\troomName: roomName,\n\t\tuserName: MyID,\n\t};\n\n\tif (currentSocket) {\n\t\tcurrentSocket.on(\"connect\", () => {\n\t\t\tcurrentSocket.emit(\"join\", myInfo);\n\t\t});\n\t}\n\n\t\n\n\t//chat owner modal\n\tconst [ChatSettingModalState, setChatSettingModalState] = useState(false);\n\tconst openChatSettingModal = () => {\n\t\tsetChatSettingModalState(true);\n\t}\n\tconst closeChatSettingModal = () => {\n\t\tsetChatSettingModalState(false);\n\t}\n\n\treturn (matched ? (\n\t\t<div id=\"App-Container\">\n\t\t  <span className=\"App-Left\">\n\t\t\t<Game a={aname} b={bname} dr={dr} speed={sbool} ladder={lbool} />\n\t\t  </span>\n\t\t  <span className=\"App-Right\">\n\t\t\t<SideBar />\n\t\t  </span>\n\t\t  <MatchFailedModal open={MatchFailed} close={closeMatchFailedModal} />\n\t\t</div>\n\t  ) : (\n\t<div id=\"App-Container\">\n\t\t{currentSocket ? (\n\t\t<div>\n\t\t<span className=\"App-Left\">\n\t\t\t<div id=\"chat-container\">\n\t\t\t<div className=\"chat-top\">\n\t\t\t\t<span className=\"RoomInfo-num\">{data?.num}</span>\n\t\t\t\t<span>{roomName}</span>\n\t\t\t\t{(MyPermission === 'owner' || MyPermission === 'admin')? \n\t\t\t\t\t<button className=\"setting-btn\" onClick={openChatSettingModal}>\n\t\t\t\t\t\t<img src={setting} width=\"30\" height=\"30\"></img>\n\t\t\t\t\t</button>\n\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t</div>\n\t\t\t<ChatSettingModal open={ChatSettingModalState} close={closeChatSettingModal} chatRoomID={roomName} MyPermission={MyPermission}></ChatSettingModal>\n\t\t\t<div className=\"chat-bottom\">\n\t\t\t\t<span className=\"left-chatLog\">\n\t\t\t\t\t<div className=\"chatLog-top\">\n\t\t\t\t\t\t<ChatLog socket={currentSocket} MyID={MyID} roomName={roomName}/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"chatLog-bottom\">\n\t\t\t\t\t\t<ChatInput socket={currentSocket} MyPermission={MyPermission}/>\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t\t<span className=\"right-chatUser\">\n\t\t\t\t\t<UserList socket={currentSocket} users={data?.users} MyPermission={MyPermission} getRoomInfoMutate={mutate} roomName={roomName}></UserList>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t</div>\n\t\t</span>\n\t\t<span className=\"App-Right\">\n\t\t\t\t<SideBar />\n\t\t</span>\n      <DirectGameModal\n        open={DirectGameModalState}\n        close={closeDirectGameModal}\n        targetID={DirectGameTarget}\n        closeUserInfoModal={null}\n      />\n\t  <MatchFailedModal open={MatchFailed} close={closeMatchFailedModal} />\n\t\t</div>\n\t\t) : (\n\t\t  <Loading></Loading>\n\t\t)}\n\t</div>\n  ));\n};\n\nexport default Chat;\n"]},"metadata":{},"sourceType":"module"}