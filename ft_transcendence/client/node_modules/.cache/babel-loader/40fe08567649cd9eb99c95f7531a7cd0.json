{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jinkim/bye_blackhole/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jinkim/bye_blackhole/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/jinkim/bye_blackhole/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import ChatInput from\"./ChatInput\";import ChatLog from\"./ChatLog\";import Loading from\"./Loading\";import UserList from\"./UserList\";import SideBar from\"../SideBar/SideBar\";import\"./styles/Chat.scss\";import setting from'../Images/setting.png';import ChatSettingModal from\"./ChatSettingModal\";import axios from\"axios\";import useSwr from'swr';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var socketIOClient=require('socket.io-client');var Chat=function Chat(){var _useState=useState(socketIOClient()),_useState2=_slicedToArray(_useState,2),currentSocket=_useState2[0],setCurrentSocket=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),MyID=_useState4[0],setMyID=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),MyIcon=_useState6[0],setMyIcon=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),roomName=_useState8[0],setRoomName=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),MyPermission=_useState10[0],setMyPermission=_useState10[1];var fetcher=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(url){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!roomName){_context.next=6;break;}_context.next=3;return axios.get(url);case 3:res=_context.sent;res.data.users=userSorting(res.data.users);return _context.abrupt(\"return\",res.data);case 6:case\"end\":return _context.stop();}}},_callee);}));return function fetcher(_x){return _ref.apply(this,arguments);};}();var _useSwr=useSwr('/Chat/info?title='+roomName,fetcher),data=_useSwr.data,error=_useSwr.error,mutate=_useSwr.mutate;function userSorting(userList){var rtn=[];var admin=[];var user=[];for(var i=0;i<userList.length;i++){if(userList[i].id===MyID)setMyPermission(userList[i].permission);if(userList[i].permission==='owner')rtn.push(userList[i]);else if(userList[i].permission==='admin')admin.push(userList[i]);else user.push(userList[i]);}admin.forEach(function(ele){return rtn.push(ele);});user.forEach(function(ele){return rtn.push(ele);});return rtn;}useEffect(function(){//setCurrentSocket(socketIOClient(\"http://localhost:8080\"));\nvar id=sessionStorage.getItem('nickname');var icon=sessionStorage.getItem('icon');var room=sessionStorage.getItem('roomName');if(id)setMyID(id);if(icon)setMyIcon(icon);if(room)setRoomName(room);});var myInfo={roomName:roomName,userName:MyID,icon:MyIcon};if(currentSocket){console.log('connect!!');currentSocket.on(\"connect\",function(){currentSocket.emit(\"join\",myInfo);});}//chat owner modal\nvar _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),ChatSettingModalState=_useState12[0],setChatSettingModalState=_useState12[1];var openChatSettingModal=function openChatSettingModal(){setChatSettingModalState(true);};var closeChatSettingModal=function closeChatSettingModal(){setChatSettingModalState(false);};return/*#__PURE__*/_jsx(\"div\",{id:\"App-Container\",children:currentSocket?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"App-Left\",children:/*#__PURE__*/_jsxs(\"div\",{id:\"chat-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-top\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"RoomInfo-num\",children:data===null||data===void 0?void 0:data.num}),/*#__PURE__*/_jsx(\"span\",{children:roomName}),MyPermission!=='user'?/*#__PURE__*/_jsx(\"button\",{className:\"setting-btn\",onClick:openChatSettingModal,children:/*#__PURE__*/_jsx(\"img\",{src:setting,width:\"30\",height:\"30\"})}):null]}),/*#__PURE__*/_jsx(ChatSettingModal,{open:ChatSettingModalState,close:closeChatSettingModal,chatRoomID:roomName,MyPermission:MyPermission}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-bottom\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"left-chatLog\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chatLog-top\",children:/*#__PURE__*/_jsx(ChatLog,{socket:currentSocket,MyID:MyID,roomName:roomName})}),/*#__PURE__*/_jsx(\"div\",{className:\"chatLog-bottom\",children:/*#__PURE__*/_jsx(ChatInput,{socket:currentSocket})})]}),/*#__PURE__*/_jsx(\"span\",{className:\"right-chatUser\",children:/*#__PURE__*/_jsx(UserList,{socket:currentSocket,users:data===null||data===void 0?void 0:data.users,MyPermission:MyPermission,getRoomInfoMutate:mutate,roomName:roomName})})]})]})}),/*#__PURE__*/_jsx(\"span\",{className:\"App-Right\",children:/*#__PURE__*/_jsx(SideBar,{})})]}):/*#__PURE__*/_jsx(Loading,{})});};export default Chat;","map":{"version":3,"sources":["/Users/jinkim/bye_blackhole/client/src/Chat/Chat.tsx"],"names":["React","useEffect","useState","ChatInput","ChatLog","Loading","UserList","SideBar","setting","ChatSettingModal","axios","useSwr","socketIOClient","require","Chat","currentSocket","setCurrentSocket","MyID","setMyID","MyIcon","setMyIcon","roomName","setRoomName","MyPermission","setMyPermission","fetcher","url","get","res","data","users","userSorting","error","mutate","userList","rtn","admin","user","i","length","id","permission","push","forEach","ele","sessionStorage","getItem","icon","room","myInfo","userName","console","log","on","emit","ChatSettingModalState","setChatSettingModalState","openChatSettingModal","closeChatSettingModal","num"],"mappings":"wcAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,SAAP,KAAsB,aAAtB,CACA,MAAOC,CAAAA,OAAP,KAAoB,WAApB,CACA,MAAOC,CAAAA,OAAP,KAAoB,WAApB,CACA,MAAOC,CAAAA,QAAP,KAAqB,YAArB,CACA,MAAOC,CAAAA,OAAP,KAAoB,oBAApB,CACA,MAAO,oBAAP,CACA,MAAOC,CAAAA,OAAP,KAAoB,uBAApB,CACA,MAAOC,CAAAA,gBAAP,KAA6B,oBAA7B,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,MAAP,KAAmB,KAAnB,C,6IACA,GAAMC,CAAAA,cAAc,CAAGC,OAAO,CAAC,kBAAD,CAA9B,CAEA,GAAMC,CAAAA,IAAI,CAAG,QAAPA,CAAAA,IAAO,EAAM,eAQwBZ,QAAQ,CAACU,cAAc,EAAf,CARhC,wCAQXG,aARW,eAQIC,gBARJ,8BASMd,QAAQ,CAAC,EAAD,CATd,yCASXe,IATW,eASLC,OATK,8BAUUhB,QAAQ,CAAC,EAAD,CAVlB,yCAUXiB,MAVW,eAUHC,SAVG,8BAWclB,QAAQ,CAAC,EAAD,CAXtB,yCAWXmB,QAXW,eAWDC,WAXC,8BAYsBpB,QAAQ,CAAC,EAAD,CAZ9B,0CAYXqB,YAZW,gBAYGC,eAZH,gBAclB,GAAMC,CAAAA,OAAO,0FAAG,iBAAOC,GAAP,8HACXL,QADW,+CAGIX,CAAAA,KAAK,CAACiB,GAAN,CAAUD,GAAV,CAHJ,QAGRE,GAHQ,eAIdA,GAAG,CAACC,IAAJ,CAASC,KAAT,CAAiBC,WAAW,CAACH,GAAG,CAACC,IAAJ,CAASC,KAAV,CAA5B,CAJc,gCAKPF,GAAG,CAACC,IALG,wDAAH,kBAAPJ,CAAAA,OAAO,4CAAb,CAdkB,YAsBYd,MAAM,CAAgD,oBAAsBU,QAAtE,CAAgFI,OAAhF,CAtBlB,CAsBXI,IAtBW,SAsBXA,IAtBW,CAsBLG,KAtBK,SAsBLA,KAtBK,CAsBEC,MAtBF,SAsBEA,MAtBF,CAwBlB,QAASF,CAAAA,WAAT,CAAqBG,QAArB,CACA,CACC,GAAIC,CAAAA,GAAY,CAAG,EAAnB,CACA,GAAIC,CAAAA,KAAc,CAAG,EAArB,CACA,GAAIC,CAAAA,IAAa,CAAG,EAApB,CAEA,IAAI,GAAIC,CAAAA,CAAC,CAAG,CAAZ,CAAeA,CAAC,CAAGJ,QAAQ,CAACK,MAA5B,CAAoCD,CAAC,EAArC,CACA,CACC,GAAIJ,QAAQ,CAACI,CAAD,CAAR,CAAYE,EAAZ,GAAmBvB,IAAvB,CACCO,eAAe,CAACU,QAAQ,CAACI,CAAD,CAAR,CAAYG,UAAb,CAAf,CAED,GAAIP,QAAQ,CAACI,CAAD,CAAR,CAAYG,UAAZ,GAA2B,OAA/B,CACCN,GAAG,CAACO,IAAJ,CAASR,QAAQ,CAACI,CAAD,CAAjB,EADD,IAEK,IAAIJ,QAAQ,CAACI,CAAD,CAAR,CAAYG,UAAZ,GAA2B,OAA/B,CACJL,KAAK,CAACM,IAAN,CAAWR,QAAQ,CAACI,CAAD,CAAnB,EADI,IAGJD,CAAAA,IAAI,CAACK,IAAL,CAAUR,QAAQ,CAACI,CAAD,CAAlB,EACD,CAEDF,KAAK,CAACO,OAAN,CAAc,SAAAC,GAAG,QAAIT,CAAAA,GAAG,CAACO,IAAJ,CAASE,GAAT,CAAJ,EAAjB,EACAP,IAAI,CAACM,OAAL,CAAa,SAAAC,GAAG,QAAIT,CAAAA,GAAG,CAACO,IAAJ,CAASE,GAAT,CAAJ,EAAhB,EACA,MAAOT,CAAAA,GAAP,CACA,CAEDlC,SAAS,CAAC,UAAM,CACf;AAEA,GAAMuC,CAAAA,EAAE,CAAGK,cAAc,CAACC,OAAf,CAAuB,UAAvB,CAAX,CACA,GAAMC,CAAAA,IAAI,CAAGF,cAAc,CAACC,OAAf,CAAuB,MAAvB,CAAb,CACA,GAAME,CAAAA,IAAI,CAAGH,cAAc,CAACC,OAAf,CAAuB,UAAvB,CAAb,CACA,GAAIN,EAAJ,CAAQtB,OAAO,CAACsB,EAAD,CAAP,CACR,GAAIO,IAAJ,CAAU3B,SAAS,CAAC2B,IAAD,CAAT,CACV,GAAIC,IAAJ,CAAU1B,WAAW,CAAC0B,IAAD,CAAX,CACV,CATQ,CAAT,CAWA,GAAMC,CAAAA,MAAM,CAAG,CACd5B,QAAQ,CAAEA,QADI,CAEd6B,QAAQ,CAAEjC,IAFI,CAGd8B,IAAI,CAAE5B,MAHQ,CAAf,CAMA,GAAIJ,aAAJ,CAAmB,CAClBoC,OAAO,CAACC,GAAR,CAAY,WAAZ,EACArC,aAAa,CAACsC,EAAd,CAAiB,SAAjB,CAA4B,UAAM,CACjCtC,aAAa,CAACuC,IAAd,CAAmB,MAAnB,CAA2BL,MAA3B,EACA,CAFD,EAGA,CAID;AA1EkB,gBA2EwC/C,QAAQ,CAAC,KAAD,CA3EhD,2CA2EXqD,qBA3EW,gBA2EYC,wBA3EZ,gBA4ElB,GAAMC,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,EAAM,CAClCD,wBAAwB,CAAC,IAAD,CAAxB,CACA,CAFD,CAGA,GAAME,CAAAA,qBAAqB,CAAG,QAAxBA,CAAAA,qBAAwB,EAAM,CACnCF,wBAAwB,CAAC,KAAD,CAAxB,CACA,CAFD,CAIA,mBACA,YAAK,EAAE,CAAC,eAAR,UACEzC,aAAa,cACd,wCACA,aAAM,SAAS,CAAC,UAAhB,uBACC,aAAK,EAAE,CAAC,gBAAR,wBACA,aAAK,SAAS,CAAC,UAAf,wBACC,aAAM,SAAS,CAAC,cAAhB,UAAgCc,IAAhC,SAAgCA,IAAhC,iBAAgCA,IAAI,CAAE8B,GAAtC,EADD,cAEC,sBAAOtC,QAAP,EAFD,CAGEE,YAAY,GAAK,MAAjB,cACA,eAAQ,SAAS,CAAC,aAAlB,CAAgC,OAAO,CAAEkC,oBAAzC,uBACC,YAAK,GAAG,CAAEjD,OAAV,CAAmB,KAAK,CAAC,IAAzB,CAA8B,MAAM,CAAC,IAArC,EADD,EADA,CAIE,IAPJ,GADA,cAWA,KAAC,gBAAD,EAAkB,IAAI,CAAE+C,qBAAxB,CAA+C,KAAK,CAAEG,qBAAtD,CAA6E,UAAU,CAAErC,QAAzF,CAAmG,YAAY,CAAEE,YAAjH,EAXA,cAYA,aAAK,SAAS,CAAC,aAAf,wBACC,cAAM,SAAS,CAAC,cAAhB,wBACC,YAAK,SAAS,CAAC,aAAf,uBACC,KAAC,OAAD,EAAS,MAAM,CAAER,aAAjB,CAAgC,IAAI,CAAEE,IAAtC,CAA4C,QAAQ,CAAEI,QAAtD,EADD,EADD,cAIC,YAAK,SAAS,CAAC,gBAAf,uBACC,KAAC,SAAD,EAAW,MAAM,CAAEN,aAAnB,EADD,EAJD,GADD,cASC,aAAM,SAAS,CAAC,gBAAhB,uBACC,KAAC,QAAD,EAAU,MAAM,CAAEA,aAAlB,CAAiC,KAAK,CAAEc,IAAF,SAAEA,IAAF,iBAAEA,IAAI,CAAEC,KAA9C,CAAqD,YAAY,CAAEP,YAAnE,CAAiF,iBAAiB,CAAEU,MAApG,CAA4G,QAAQ,CAAEZ,QAAtH,EADD,EATD,GAZA,GADD,EADA,cA6BA,aAAM,SAAS,CAAC,WAAhB,uBACE,KAAC,OAAD,IADF,EA7BA,GADc,cAmCZ,KAAC,OAAD,IApCH,EADA,CAyCA,CA5HD,CA8HA,cAAeP,CAAAA,IAAf","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport ChatInput from \"./ChatInput\";\nimport ChatLog from \"./ChatLog\";\nimport Loading from \"./Loading\";\nimport UserList from \"./UserList\";\nimport SideBar from \"../SideBar/SideBar\";\nimport \"./styles/Chat.scss\"\nimport setting from '../Images/setting.png'\nimport ChatSettingModal from \"./ChatSettingModal\";\nimport axios from \"axios\";\nimport useSwr from 'swr';\nconst socketIOClient = require('socket.io-client')\n\nconst Chat = () => {\n\t\n\tinterface Iuser{\n\t\tid:string,\n\t\tpermission:string,\n\t\ticon:string\n\t}\n\n\tconst [currentSocket, setCurrentSocket] = useState(socketIOClient());\n\tconst [MyID, setMyID] = useState('')\n\tconst [MyIcon, setMyIcon] = useState('')\n\tconst [roomName, setRoomName] = useState('')\n\tconst [MyPermission, setMyPermission] = useState('')\n\n\tconst fetcher = async (url:string) => {\n\t\tif (roomName)\n\t\t{\n\t\t\tconst res = await axios.get(url)\n\t\t\tres.data.users = userSorting(res.data.users)\n\t\t\treturn res.data;\n\t\t}\n\t}\n\tconst {data, error, mutate} = useSwr<{num:string, security: string, users:Iuser[]}>('/Chat/info?title=' + roomName, fetcher)\n\n\tfunction userSorting(userList:Iuser[])\n\t{\n\t\tvar rtn: Iuser[] = []\n\t\tvar admin: Iuser[] = []\n\t\tvar user: Iuser[] = []\n\n\t\tfor(let i = 0; i < userList.length; i++)\n\t\t{\n\t\t\tif (userList[i].id === MyID)\n\t\t\t\tsetMyPermission(userList[i].permission)\n\t\t\t\n\t\t\tif (userList[i].permission === 'owner')\n\t\t\t\trtn.push(userList[i])\n\t\t\telse if (userList[i].permission === 'admin')\n\t\t\t\tadmin.push(userList[i])\n\t\t\telse\n\t\t\t\tuser.push(userList[i])\n\t\t}\n\t\t\n\t\tadmin.forEach(ele => rtn.push(ele))\n\t\tuser.forEach(ele => rtn.push(ele))\n\t\treturn rtn\n\t}\n\n\tuseEffect(() => {\n\t\t//setCurrentSocket(socketIOClient(\"http://localhost:8080\"));\n\t\t\n\t\tconst id = sessionStorage.getItem('nickname')\n\t\tconst icon = sessionStorage.getItem('icon')\n\t\tconst room = sessionStorage.getItem('roomName')\n\t\tif (id) setMyID(id)\n\t\tif (icon) setMyIcon(icon)\n\t\tif (room) setRoomName(room)\n\t});\n\t\n\tconst myInfo = {\n\t\troomName: roomName,\n\t\tuserName: MyID,\n\t\ticon: MyIcon,\n\t};\n\n\tif (currentSocket) {\n\t\tconsole.log('connect!!')\n\t\tcurrentSocket.on(\"connect\", () => {\n\t\t\tcurrentSocket.emit(\"join\", myInfo);\n\t\t});\n\t}\n\n\t\n\n\t//chat owner modal\n\tconst [ChatSettingModalState, setChatSettingModalState] = useState(false);\n\tconst openChatSettingModal = () => {\n\t\tsetChatSettingModalState(true);\n\t}\n\tconst closeChatSettingModal = () => {\n\t\tsetChatSettingModalState(false);\n\t}\n\n\treturn (\n\t<div id=\"App-Container\">\n\t\t{currentSocket ? (\n\t\t<>\n\t\t<span className=\"App-Left\">\n\t\t\t<div id=\"chat-container\">\n\t\t\t<div className=\"chat-top\">\n\t\t\t\t<span className=\"RoomInfo-num\">{data?.num}</span>\n\t\t\t\t<span>{roomName}</span>\n\t\t\t\t{MyPermission !== 'user' ? \n\t\t\t\t\t<button className=\"setting-btn\" onClick={openChatSettingModal}>\n\t\t\t\t\t\t<img src={setting} width=\"30\" height=\"30\"></img>\n\t\t\t\t\t</button>\n\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t</div>\n\t\t\t<ChatSettingModal open={ChatSettingModalState} close={closeChatSettingModal} chatRoomID={roomName} MyPermission={MyPermission}></ChatSettingModal>\n\t\t\t<div className=\"chat-bottom\">\n\t\t\t\t<span className=\"left-chatLog\">\n\t\t\t\t\t<div className=\"chatLog-top\">\n\t\t\t\t\t\t<ChatLog socket={currentSocket} MyID={MyID} roomName={roomName}/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"chatLog-bottom\">\n\t\t\t\t\t\t<ChatInput socket={currentSocket}/>\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t\t<span className=\"right-chatUser\">\n\t\t\t\t\t<UserList socket={currentSocket} users={data?.users} MyPermission={MyPermission} getRoomInfoMutate={mutate} roomName={roomName}></UserList>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t</div>\n\t\t</span>\n\t\t<span className=\"App-Right\">\n\t\t\t\t<SideBar />\n\t\t</span>\n\t\t</>\n\t\t) : (\n\t\t  <Loading></Loading>\n\t\t)}\n\t</div>\n  );\n};\n\nexport default Chat;\n"]},"metadata":{},"sourceType":"module"}